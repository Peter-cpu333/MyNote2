# 前后端对接

## 🔍 错误分析

### 1. **API路径不匹配问题**

**错误现象：**
- 后端日志显示 `POST /api/users 307 Temporary Redirect`
- 前端收到重定向而不是预期的响应

**根本原因：**
```javascript
// 前端发送请求到
POST /api/users

// 但后端路由定义为
POST /api/users/  // 注意末尾的斜杠
```

**为什么会这样：**
- FastAPI 对路径严格匹配
- `/api/users` 和 `/api/users/` 被视为不同的端点
- 当路径不完全匹配时，FastAPI 会发送 307 重定向到正确路径
- 但前端的 axios 默认不会自动处理 307 重定向的 POST 请求

### 2. **Content-Type 格式错误**

**错误现象：**
- 登录请求返回 422 Unprocessable Entity
- 后端无法解析请求数据

**根本原因：**
```javascript
// 前端发送的格式
Content-Type: application/x-www-form-urlencoded
// 数据: username=xxx&password=xxx

// 但后端期望的格式
Content-Type: application/json
// 数据: {"username": "xxx", "password": "xxx"}
```

**为什么会这样：**
- 前端使用了 `URLSearchParams` 将数据转换为表单格式
- 但后端的 Pydantic 模型期望接收 JSON 格式
- FastAPI 根据 Content-Type 来决定如何解析请求体

### 3. **响应数据处理错误**

**错误现象：**
- TypeScript 类型错误：`Property 'access_token' does not exist`
- 无法正确获取登录令牌

**根本原因：**
```javascript
// API 响应拦截器返回
response.data  // 实际的响应数据

// 但代码中尝试访问
loginResponse.access_token  // loginResponse 是 AxiosResponse 类型
```

**为什么会这样：**
- axios 响应拦截器已经提取了 `response.data`
- 但前端代码没有意识到这一点，仍然按照完整响应对象来处理
- TypeScript 类型检查发现了这个不一致

## 📚 学习要点

### 1. **API 设计一致性**
- 前后端路径定义要完全一致（包括斜杠）
- 使用 API 文档或 OpenAPI 规范来确保一致性

### 2. **HTTP Content-Type 理解**
- `application/json`: JSON 格式数据
- `application/x-www-form-urlencoded`: 表单格式数据
- 前后端必须使用相同的数据格式

### 3. **响应拦截器的影响**
- 了解 axios 拦截器如何修改响应结构
- 确保前端代码与拦截器逻辑一致

### 4. **调试技巧**
- 查看浏览器网络面板的请求/响应详情
- 检查后端日志中的 HTTP 状态码
- 使用 curl 命令直接测试 API 端点

这些错误都是在前后端集成过程中非常典型的问题，理解它们有助于你在未来的开发中更快地定位和解决类似问题！
        